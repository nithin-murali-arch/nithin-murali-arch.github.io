<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Dinner Schedule Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css" />
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-database-compat.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyApAgsox7rvSNjbqWqMlVMf69e6_ApqcJw",
          authDomain: "meal-plan-sync.firebaseapp.com",
          databaseURL: "https://meal-plan-sync-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "meal-plan-sync",
          storageBucket: "meal-plan-sync.firebasestorage.app",
          messagingSenderId: "156023355933",
          appId: "1:156023355933:web:8ed2ac6278a8387f9224f4",
          measurementId: "G-R18SLY36WV"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
      </script>
</head>
<body>
    <div class="container">
        <div id="login-screen" style="text-align: center; padding-top: 100px;">
            <h1>Dinner Schedule Generator</h1>
            <p>Please log in with your Google Account to continue.</p>
            <button id="login-btn" class="btn btn-primary">Sign in with Google</button>
        </div>
    
        <div class="container" style="display: none;">
            <header>
                <h1>Dinner Schedule Generator</h1>
                <p>Your personalized weekly meal plan, intelligently crafted.</p>
                <div class="collaboration-container">
                    <div id="presence-indicators" class="presence-indicators"></div>
                    <div class="share-controls">
                        <button id="share-btn" class="btn btn-secondary">Share</button>
                        <button id="stop-sharing-btn" class="btn btn-secondary">Stop Sharing</button>
                    </div>
                </div>
            </header>
    
            </div>

        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'generator')">Plan Generator</button>
            <button class="tab-link" onclick="openTab(event, 'manage')">Manage Plans</button>
            <button class="tab-link" onclick="openTab(event, 'history')">History</button>
        </div>

        <div id="generator" class="tab-content" style="display: block;">
            <div class="controls">
                <button id="generate-btn" class="btn btn-primary">Generate Meal Plan</button>
                <div class="toggle-switch">
                    <label for="duration-toggle">Generate for Rest of Year</label>
                    <input type="checkbox" id="duration-toggle">
                    <span class="slider"></span>
                </div>
                 <div id="saved-plans-container" style="display: none;">
                    <select id="saved-plans"></select>
                 </div>
                 <a href="./recipe_book.html" target="_blank" class="btn btn-secondary">View Cookbook</a>
                 <button id="print-btn" class="btn btn-secondary" style="display: none;">Print</button>
                 <button id="save-changes-btn" class="btn btn-primary" style="display: none;">Save Changes</button>
            </div>
    
            <details id="rules-container">
                <summary>View Scheduling Rules</summary>
                <!-- Rules will be dynamically populated by app.js -->
            </details>
    
            <div id="output" class="output-section">
                <div class="output-grid">
                    <div id="schedule-wrapper">
                        <h2 class="section-title">Dinner Schedule</h2>
                        <div id="schedule-container"></div>
                    </div>
                    <div id="shopping-list-wrapper">
                         <h2 class="section-title">Weekly Shopping List</h2>
                        <div id="shopping-list-container"></div>
                    </div>
                </div>
    
                <div id="print-schedule-container" class="print-only">
                    <h2 class="section-title">Dinner Schedule</h2>
                    <table id="print-schedule-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Main Dish</th>
                                <th>Side Dish</th>
                            </tr>
                        </thead>
                        <tbody id="print-schedule-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="manage" class="tab-content">
            <div class="manage-container">
                <h2 class="section-title">Manage Saved Plans</h2>
                <div id="manage-plans-list"></div>
            </div>
        </div>
        
        <div id="history" class="tab-content">
            <div class="manage-container">
                <h2 class="section-title">Import & View Meal History</h2>
                <p>You can import a meal history to influence future plan generations. The format should be a JSON array of past schedule items.</p>
                <textarea id="history-import-text" rows="10" placeholder="Paste meal history JSON here..."></textarea>
                <button id="import-history-btn" class="btn btn-primary">Import & Overwrite History</button>
                <h3>Current History</h3>
                <div id="current-history-display"></div>
            </div>
        </div>

    </div>

    <div id="replace-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <h3 id="modal-title">Choose a Replacement</h3>
            <div id="replacement-options"></div>
        </div>
    </div>
    
    <script src="./config.js"></script>
    <script src="./ingredients.js"></script>
    <script src="./rules.js"></script>
    <script src="./scheduler.js"></script>
    <script src="./app.js"></script>
</body>
</html>

