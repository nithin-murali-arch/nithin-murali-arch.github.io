<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIRE Calculator - Financial Independence Calculator</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nithin-murali-arch.github.io/adults/calculators/fire/preview.html">
    <meta property="og:title" content="FIRE Calculator - Financial Independence Calculator">
    <meta property="og:description"
        content="Calculate your path to Financial Independence, Retire Early (FIRE) with our comprehensive calculator.">
    <meta property="og:site_name" content="FIRE Calculator">
    <meta property="og:locale" content="en_US">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:alt" content="FIRE Calculator - Financial Independence Calculator">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://nithin-murali-arch.github.io/adults/calculators/fire/preview.html">
    <meta property="twitter:title" content="FIRE Calculator - Financial Independence Calculator">
    <meta property="twitter:description"
        content="Calculate your path to Financial Independence, Retire Early (FIRE) with our comprehensive calculator.">

    <!-- LinkedIn -->
    <meta property="linkedin:owner" content="nithin-murali-arch">
    <meta name="author" content="Nithin Murali">
    <meta name="description"
        content="Calculate your path to Financial Independence, Retire Early (FIRE) with our comprehensive calculator.">

    <!-- Additional Meta Tags -->
    <meta name="keywords"
        content="FIRE calculator, financial independence, retire early, retirement planning, investment calculator, portfolio growth, financial freedom">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#FF6B35">
    <meta name="application-name" content="FIRE Calculator">
    <meta name="apple-mobile-web-app-title" content="FIRE Calculator">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X7566Q6TZM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-X7566Q6TZM');
    </script>
    <!-- Structured Data for LinkedIn -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "FIRE Calculator Results",
        "description": "Personalized FIRE (Financial Independence, Retire Early) journey results and calculator.",
        "url": "https://nithin-murali-arch.github.io/adults/calculators/fire/preview.html",
        "mainEntity": {
            "@type": "WebApplication",
            "name": "FIRE Calculator",
            "description": "Calculate your path to Financial Independence, Retire Early (FIRE) with our comprehensive calculator.",
            "applicationCategory": "FinanceApplication",
            "operatingSystem": "Web Browser",
            "author": {
                "@type": "Person",
                "name": "Nithin Murali"
            },
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            }
        },
        "author": {
            "@type": "Person",
            "name": "Nithin Murali"
        },
        "publisher": {
            "@type": "Organization",
            "name": "FIRE Calculator"
        }
    }
    </script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        .preview-container {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            max-width: 90vw;
            width: 100%;
            max-width: 800px;
            margin: 20px;
        }

        .fire-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 0 15px 0;
            background: linear-gradient(135deg, #FF6B35 0%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #cccccc;
            margin-bottom: 25px;
            font-weight: 400;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .result-item {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #FF6B35;
            margin-bottom: 5px;
        }

        .result-label {
            font-size: 0.85rem;
            color: #cccccc;
            font-weight: 500;
        }

        .user-greeting {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .user-greeting h3 {
            margin: 0 0 8px 0;
            color: #FF6B35;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .user-greeting p {
            margin: 0;
            color: #cccccc;
            font-size: 1rem;
            line-height: 1.4;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .feature {
            text-align: center;
            padding: 15px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 107, 53, 0.2);
            min-width: 120px;
        }

        .feature-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .feature-text {
            font-size: 0.9rem;
            color: #cccccc;
            font-weight: 500;
        }

        .url {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 0.9rem;
            color: #888888;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B35 0%, #FFD700 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 20px;
            transition: transform 0.2s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
        }

        .message-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .message-box h4 {
            margin: 0 0 10px 0;
            color: #FF6B35;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .message-box p {
            margin: 0;
            color: #cccccc;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            height: 300px;
            position: relative;
        }

        .chart-title {
            color: #FF6B35;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .import-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            text-align: center;
        }

        .import-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .import-button:hover {
            transform: translateY(-2px);
        }

        .import-note {
            margin-top: 10px;
            color: #cccccc;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .preview-container {
                padding: 30px 15px;
                margin: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .features {
                gap: 15px;
            }

            .feature {
                min-width: 100px;
                padding: 12px;
            }

            .chart-container {
                height: 250px;
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="preview-container">
        <span class="fire-icon">ðŸ”¥</span>
        <h1>FIRE Calculator</h1>
        <div class="subtitle">Financial Independence, Retire Early</div>

        <div id="user-results" style="display: none;">
            <div class="user-greeting" id="user-greeting">
                <h3>ðŸŽ‰ Congratulations!</h3>
                <p>You've calculated your path to financial independence!</p>
            </div>

            <div class="results-grid" id="results-grid">
                <!-- Results will be populated by JavaScript -->
            </div>

            <div class="chart-container" id="portfolio-chart-container">
                <div class="chart-title">Portfolio Growth Over Time</div>
                <canvas id="portfolio-chart"></canvas>
            </div>

            <div class="message-box">
                <h4>ðŸ’¡ What This Means</h4>
                <p>Based on your financial inputs, you can achieve financial independence and retire early! This
                    calculator considers your current savings, monthly investments, expected returns, and living
                    expenses to project your FIRE journey.</p>
            </div>
        </div>

        <div id="default-content">
            <div class="message-box">
                <h4>ðŸš€ Start Your FIRE Journey</h4>
                <p>Calculate your path to financial independence with our comprehensive FIRE calculator. Input your
                    current financial situation and discover when you can achieve financial freedom!</p>
            </div>

            <div class="features">
                <div class="feature">
                    <span class="feature-icon">ðŸ“Š</span>
                    <div class="feature-text">Portfolio Growth</div>
                </div>
                <div class="feature">
                    <span class="feature-icon">ðŸŽ¯</span>
                    <div class="feature-text">Goal Planning</div>
                </div>
                <div class="feature">
                    <span class="feature-icon">ðŸ“ˆ</span>
                    <div class="feature-text">Asset Allocation</div>
                </div>
            </div>
        </div>

        <a href="https://nithin-murali-arch.github.io/adults/calculators/fire/" class="cta-button">
            Calculate Your FIRE Journey â†’
        </a>
        
        <div class="import-section">
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleFileImport(event)">
            <button class="import-button" onclick="document.getElementById('import-file').click()">
                <i class="fas fa-upload"></i> Import FIRE Data
            </button>
            <p class="import-note">Import your exported FIRE calculator data to see your results here</p>
        </div>
    </div>

    <div class="url">nithin-murali-arch.github.io</div>

    <script>
        // Debug: log URL parameters
        console.log('Preview page loaded');
        console.log('Current URL:', window.location.href);

        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        console.log('URL parameters:', Object.fromEntries(urlParams.entries()));

        // Check if we have FIRE results data
        const fireAge = decodeURIComponent(urlParams.get('fireAge') || '');
        const yearsToFire = decodeURIComponent(urlParams.get('yearsToFire') || '');
        const finalCorpus = decodeURIComponent(urlParams.get('finalCorpus') || '');
        const fireNumber = decodeURIComponent(urlParams.get('fireNumber') || '');
        const userName = decodeURIComponent(urlParams.get('userName') || '');
        const chartData = decodeURIComponent(urlParams.get('chartData') || '');

        console.log('Parsed data:', { fireAge, yearsToFire, finalCorpus, fireNumber, userName, chartData });

        if (fireAge && yearsToFire && fireAge !== '--' && yearsToFire !== '--') {
            console.log('Showing personalized results');
            // Show results
            document.getElementById('default-content').style.display = 'none';
            document.getElementById('user-results').style.display = 'block';

            // Update user greeting
            if (userName && userName !== 'User') {
                document.getElementById('user-greeting').innerHTML = `
                    <h3>ðŸŽ‰ Congratulations, ${userName}!</h3>
                    <p>You can achieve financial independence at age ${fireAge} in ${yearsToFire} years!</p>
                `;
            } else {
                document.getElementById('user-greeting').innerHTML = `
                    <h3>ðŸŽ‰ Congratulations!</h3>
                    <p>You can achieve financial independence at age ${fireAge} in ${yearsToFire} years!</p>
                `;
            }

            // Populate results grid
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = `
                <div class="result-item">
                    <div class="result-value">${fireAge}</div>
                    <div class="result-label">FIRE Age</div>
                </div>
                <div class="result-item">
                    <div class="result-value">${yearsToFire}</div>
                    <div class="result-label">Years to FIRE</div>
                </div>
                <div class="result-item">
                    <div class="result-value">${finalCorpus || '--'}</div>
                    <div class="result-label">Projected Corpus</div>
                </div>
            `;

            // Render chart if data is available
            if (chartData) {
                try {
                    const parsedChartData = JSON.parse(chartData);
                    renderPortfolioChart(parsedChartData);
                } catch (error) {
                    console.error('Error parsing chart data:', error);
                    // Hide chart container if no valid data
                    document.getElementById('portfolio-chart-container').style.display = 'none';
                }
            } else {
                // Hide chart container if no data
                document.getElementById('portfolio-chart-container').style.display = 'none';
            }

            // Update meta tags for social sharing
            const displayName = userName && userName !== 'User' ? userName : 'User';
            const shareText = `${displayName} can achieve financial independence at age ${fireAge} in ${yearsToFire} years! Calculate your own FIRE journey.`;
            const pageTitle = `${displayName}'s FIRE Journey - Age ${fireAge}`;

            // Update all meta tags
            document.querySelector('meta[property="og:title"]').setAttribute('content', pageTitle);
            document.querySelector('meta[property="og:description"]').setAttribute('content', shareText);
            document.querySelector('meta[property="twitter:title"]').setAttribute('content', pageTitle);
            document.querySelector('meta[property="twitter:description"]').setAttribute('content', shareText);
            document.querySelector('meta[name="description"]').setAttribute('content', shareText);

            // Update page title
            document.title = pageTitle;

            // Update structured data
            const structuredData = {
                "@context": "https://schema.org",
                "@type": "WebPage",
                "name": pageTitle,
                "description": shareText,
                "url": "https://nithin-murali-arch.github.io/adults/calculators/fire/preview.html",
                "mainEntity": {
                    "@type": "WebApplication",
                    "name": "FIRE Calculator",
                    "description": shareText,
                    "applicationCategory": "FinanceApplication",
                    "operatingSystem": "Web Browser",
                    "author": {
                        "@type": "Person",
                        "name": "Nithin Murali"
                    },
                    "offers": {
                        "@type": "Offer",
                        "price": "0",
                        "priceCurrency": "USD"
                    }
                },
                "author": {
                    "@type": "Person",
                    "name": "Nithin Murali"
                },
                "publisher": {
                    "@type": "Organization",
                    "name": "FIRE Calculator"
                }
            };

            // Update the structured data script
            const scriptElement = document.querySelector('script[type="application/ld+json"]');
            if (scriptElement) {
                scriptElement.textContent = JSON.stringify(structuredData, null, 2);
            }

        } else {
            console.log('Showing default content - no valid data found');
            // Show default content if no valid data
            document.getElementById('default-content').style.display = 'block';
            document.getElementById('user-results').style.display = 'none';
        }

        // Function to render portfolio chart
        function renderPortfolioChart(chartData) {
            const ctx = document.getElementById('portfolio-chart').getContext('2d');

            // Configure Chart.js for dark theme
            Chart.defaults.color = '#cccccc';
            Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels || [],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: chartData.datasets?.[0]?.data || [],
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#FF6B35',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#cccccc',
                            borderColor: '#FF6B35',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#cccccc',
                                maxTicksLimit: 8
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#cccccc',
                                callback: function (value) {
                                    return 'â‚¹' + (value / 100000).toFixed(1) + 'L';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Function to handle file import
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    displayImportedData(importedData);
                } catch (error) {
                    console.error('Error parsing imported file:', error);
                    alert('Invalid file format. Please select a valid FIRE calculator export file.');
                }
            };
            reader.readAsText(file);
        }

        // Function to display imported data
        function displayImportedData(importedData) {
            console.log('Displaying imported data:', importedData);
            
            // Handle both old format (with formData wrapper) and new format (direct properties)
            let dataToDisplay = importedData;
            if (importedData.formData) {
                // Old format - extract formData
                dataToDisplay = importedData.formData;
            }
            
            // Validate the imported data
            if (!dataToDisplay || (typeof dataToDisplay !== 'object')) {
                alert('Invalid FIRE calculator data format.');
                return;
            }
            
            // Show results section
            document.getElementById('default-content').style.display = 'none';
            document.getElementById('user-results').style.display = 'block';

            const userName = dataToDisplay.userName || 'User';
            const fireAge = dataToDisplay.fireAge || dataToDisplay.earliestFireAge || '--';
            const yearsToFire = dataToDisplay.yearsToFire || '--';
            const finalCorpus = dataToDisplay.finalCorpus || '--';
            const coastFireAge = dataToDisplay.coastFireAge || '--';
            const coastFireYears = dataToDisplay.coastFireYears || '--';
            const exportDate = importedData.exportDate || new Date().toISOString();

            // Update user greeting
            document.getElementById('user-greeting').innerHTML = `
                <h3>ðŸŽ‰ Welcome back, ${userName}!</h3>
                <p>Here are your FIRE calculation results from ${new Date(exportDate).toLocaleDateString()}</p>
            `;

            // Populate results grid with imported data
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = `
                <div class="result-item">
                    <div class="result-value">${fireAge}</div>
                    <div class="result-label">FIRE Age</div>
                </div>
                <div class="result-item">
                    <div class="result-value">${yearsToFire}</div>
                    <div class="result-label">Years to FIRE</div>
                </div>
                <div class="result-item">
                    <div class="result-value">${finalCorpus}</div>
                    <div class="result-label">Projected Corpus</div>
                </div>
                <div class="result-item">
                    <div class="result-value">${coastFireAge}</div>
                    <div class="result-label">Coast FIRE Age</div>
                </div>
            `;

            // Render chart if portfolio history data is available
            if (dataToDisplay.portfolioHistory && Array.isArray(dataToDisplay.portfolioHistory)) {
                // Create chart data from portfolio history
                const chartData = {
                    labels: dataToDisplay.portfolioHistory.map(item => `Year ${item.year}`),
                    datasets: [{
                        data: dataToDisplay.portfolioHistory.map(item => {
                            // Sum all asset values for each year
                            return Object.values(item).reduce((sum, value) => {
                                return typeof value === 'number' ? sum + value : sum;
                            }, 0);
                        })
                    }]
                };
                renderPortfolioChart(chartData);
            } else if (importedData.chartData && importedData.chartData.portfolioGrowth) {
                // Fallback to old chart data format
                renderPortfolioChart(importedData.chartData.portfolioGrowth);
            } else {
                document.getElementById('portfolio-chart-container').style.display = 'none';
            }

            // Update meta tags for social sharing
            const shareText = `${userName} can achieve financial independence at age ${fireAge} in ${yearsToFire} years! Calculate your own FIRE journey.`;
            const pageTitle = `${userName}'s FIRE Journey - Age ${fireAge}`;

            // Update all meta tags
            document.querySelector('meta[property="og:title"]').setAttribute('content', pageTitle);
            document.querySelector('meta[property="og:description"]').setAttribute('content', shareText);
            document.querySelector('meta[property="twitter:title"]').setAttribute('content', pageTitle);
            document.querySelector('meta[property="twitter:description"]').setAttribute('content', shareText);
            document.querySelector('meta[name="description"]').setAttribute('content', shareText);

            // Update page title
            document.title = pageTitle;

            // Track import event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'import_data_preview', {
                    event_category: 'engagement',
                    event_label: 'FIRE Calculator Preview Import'
                });
            }
        }
    </script>
</body>

</html>